#!/bin/sh

DIR=$(dirname `readlink -f $0`)
TERMUX_BLD_DIR="$DIR/../../termux-packages"
DEBS_DIR="$DIR/../debs"
ARCH=arm
LATEST_DEB="swi-prolog_latest_arm.deb"

if [ x"$1" == x"-f" ]; then
   FORCE="-f"
fi

if [ ! -d "$TERMUX_BLD_DIR" ]; then
   echo "$TERMUX_BLD_DIR not found."
   echo
   echo "termux-packages repository doesn\'t exist, please run:"
   echo "   git clone https://github.com/erlanger/termux-packages"
   echo "in the parent directory of this repository."
fi
   
                        ######################
                        #   Build new debs   #
                        ######################
BUILD_CMD="./build-package.sh -a $ARCH $FORCE swi-prolog"
"$TERMUX_BLD_DIR/scripts/run-docker.sh"  "$BUILD_CMD"


                     ##############################
                     #  Move debs to release repo #
                     ##############################
cp "$TERMUX_BLD_DIR/debs/swi-prolog_"*"_arm.deb" "$DEBS_DIR"
cd "$DEBS_DIR"
rm "$LATEST_DEB"
cp -f "./swi-prolog_7"*"_arm.deb" ./"$LATEST_DEB"
